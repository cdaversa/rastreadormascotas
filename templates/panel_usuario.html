{% extends "base.html" %}

{% block title %}Panel Usuario - {{ session.user_nombre }}{% endblock %}

{% block content %}
<h2>Panel de {{ session.user_nombre }}</h2>
<a href="{{ url_for('logout') }}" class="btn btn-warning mb-3">Cerrar sesión</a>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, msg in messages %}
      <div class="alert alert-{{category}}">{{ msg }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

<h4>Tus Mascotas</h4>
{% if mascotas %}
  <table class="table table-bordered align-middle">
    <thead>
      <tr>
        <th>Foto</th>
        <th>Nombre</th>
        <th>Raza</th>
        <th>Descripción</th>
        <th>Código QR</th>
      </tr>
    </thead>
    <tbody>
      {% for m in mascotas %}
        <tr>
          <td style="width:100px;">
            {% if m['foto'] %}
              <img src="{{ url_for('static', filename='uploads/' + m['foto']) }}" alt="Foto de {{ m['nombre'] }}" style="max-width:80px; max-height:80px; object-fit:cover; border-radius:5px;">
            {% else %}
              <span class="text-muted">Sin foto</span>
            {% endif %}
          </td>
          <td>{{ m['nombre'] }}</td>
          <td>{{ m['raza'] }}</td>
          <td>{{ m['descripcion'] }}</td>
          <td>
            <a href="{{ url_for('pagina_mascota', codigo=m['codigo']) }}" target="_blank">{{ m['codigo'] }}</a>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>
{% else %}
  <p>No tienes mascotas registradas.</p>
{% endif %}

<h4>Registrar nueva mascota</h4>
<form method="post" enctype="multipart/form-data">
    <div class="mb-3">
        <label>Nombre Mascota</label>
        <input type="text" name="nombre_mascota" class="form-control" required />
    </div>
    <div class="mb-3">
        <label>Raza</label>
        <input type="text" name="raza" class="form-control" />
    </div>
    <div class="mb-3">
        <label>Descripción</label>
        <textarea name="descripcion" class="form-control"></textarea>
    </div>
    <div class="mb-3">
        <label>Código QR (ingresá el código que figura en la chapita)</label>
        <input type="text" name="qr_code" class="form-control" required maxlength="20" />
    </div>
    <div class="mb-3">
        <label>Foto de la mascota</label>
        <input type="file" name="foto" accept="image/*" class="form-control" />
    </div>
    <button class="btn btn-success" type="submit">Registrar Mascota</button>
</form>
{% endblock %}
